# Роллинг рестарт

Механизм роллинг рестарта используется для обновления версии {{ ydb-short-name }} и применения изменений в конфигурации.

## Утилита ydb-rolling-restart {#description}

Запуск роллинг рестарта производится утилитой ydb-rolling-restart. Контроль процесса перезагрузки со стороны перезагружаемого кластера {{ ydb-short-name }} позволяет избежать деградации. Утилита использует системный ssh-клиент для для подключения к узлам кластера и выполнения команды перезагрузки процессов {{ ydb-short-name }}.

Пример запуска перезагрузки storage узлов:

### Перезагрузка storage {#storage}

Примеры перезагрузки storage узлов:

  ```
  ydb-rolling-restart --addr <node list> --service storage
  ```

где `<node list>` - это список узлов кластера разделенных запятыми.

### Перезагрузка динамических узлов {#dynnode}

Примеры перезагрузки узлов базы данных:

  ```
  ydb-rolling-restart --addr <node list> --service dynnode --database <database name>
  ```

где:
  - `<node list>` - это список узлов кластера разделенных запятыми
  - `<database name>` - имя рестартуемой базы данных

### Выбор режим доступности при рестарте storage узлов {#availability-mode}

Процесс рестарта storage узлов учитывает структуру и тип erasue blob storage групп кластера. Это позволяет перезагружать узлы в рамках модели отказа без фатальной деградации (недоступности).
С помощю опции ```--availability-mode <mode>``` возможно выбрать режим доступности.
где `<mode>` может принимать один из трех вариантов:
  - `max` - разрешается рестарт узлов если он приведет к недоступность максимум одного диска из blob storage групп
  - `keep` - разрешается рестарт узлов если он не приведет к недоступности blob storage групп
  - `force` - рестарт с недоступностью blob storage групп

{% note warning %}

Использование режима ```--availability-mode force``` приведет к одновременной перезагрузке всех узлов. Используйте этот режим в случае крайней необходимости.

{% endnote %}


### Параметры утилиты рестарта {#parameters}

Есть возможность управлять запуском рестарта с помощю параметров:
  - `--hosts <host list>` - перезагрузить узлы только на хостах из указанного списка
  - `--exclude-hosts <host list>` - исключить из перезагрузки узлы на хостах из списка
  - `--ssh-pool-size <number>` - лимит на число удаленных соединений с узлами кластера через ssh
